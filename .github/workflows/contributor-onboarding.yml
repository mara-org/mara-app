# Mara Automation â€“ Contributor Onboarding
# Welcomes new contributors and provides helpful links
# Frontend-only: helps onboard contributors to the frontend repo

name: Mara Automation â€“ Contributor Onboarding

on:
  pull_request:
    types: [opened]

jobs:
  welcome-contributor:
    name: Welcome Contributor
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      issues: read

    steps:
      - name: Check if first-time contributor
        id: check_contributor
        uses: actions/github-script@v8
        with:
          script: |
            const prAuthor = context.payload.pull_request.user.login;
            
            // Check if this is the author's first PR
            const { data: prs } = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'all',
              per_page: 100,
            });
            
            const authorPRs = prs.filter(pr => pr.user.login === prAuthor);
            const isFirstPR = authorPRs.length === 1;
            
            return { isFirstPR, prAuthor };

      - name: Welcome message for first-time contributors
        if: steps.check_contributor.outputs.isFirstPR == 'true'
        uses: actions/github-script@v8
        with:
          script: |
            const prNumber = context.payload.pull_request.number;
            const prAuthor = context.payload.pull_request.user.login;
            
            const welcomeMessage = `## ðŸ‘‹ Welcome to Mara, @${prAuthor}!
            
            Thank you for your first contribution to the Mara app! ðŸŽ‰
            
            ### ðŸ“š Helpful Resources
            
            - **[CONTRIBUTING.md](../CONTRIBUTING.md)**: Coding guidelines and contribution process
            - **[docs/ARCHITECTURE.md](../docs/ARCHITECTURE.md)**: Architecture overview and design patterns
            - **[README.md](../README.md)**: Project overview and setup instructions
            - **[docs/FRONTEND_SLOS.md](../docs/FRONTEND_SLOS.md)**: Service level objectives
            
            ### ðŸš€ Quick Start
            
            1. **Setup environment:**
               \`\`\`bash
               bash scripts/setup-dev-environment.sh
               \`\`\`
            
            2. **Run tests:**
               \`\`\`bash
               flutter test
               \`\`\`
            
            3. **Check code quality:**
               \`\`\`bash
               flutter analyze
               dart format .
               \`\`\`
            
            ### ðŸ“‹ PR Checklist
            
            - [ ] Code follows project style guidelines
            - [ ] Tests added/updated (if applicable)
            - [ ] Documentation updated (if applicable)
            - [ ] CI checks passing
            
            ### ðŸ’¡ Tips
            
            - This is a **frontend-only** repository (Flutter mobile app)
            - Backend code lives in a separate repository
            - All changes should be frontend-focused
            
            We're here to help! If you have questions, feel free to ask in the PR comments.`;
            
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              body: welcomeMessage,
            });

